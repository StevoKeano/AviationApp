<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="AviationApp.MainPage"
             Background="{Binding PageBackground, FallbackValue=Transparent}">
    <ContentPage.Resources>
        <!-- Define Gradients -->
        <LinearGradientBrush x:Key="ActiveGradient" EndPoint="0,1">
            <GradientStop Color="#FF4500" Offset="0.0" />
            <GradientStop Color="#FF8C00" Offset="1.0" />
        </LinearGradientBrush>
        <LinearGradientBrush x:Key="PausedGradient" EndPoint="0,1">
            <GradientStop Color="#696969" Offset="0.0" />
            <GradientStop Color="#A9A9A9" Offset="1.0" />
        </LinearGradientBrush>
        <LinearGradientBrush x:Key="FailedGradient" EndPoint="0,1">
            <GradientStop Color="#FFA500" Offset="0.0" />
            <GradientStop Color="#FFD700" Offset="1.0" />
        </LinearGradientBrush>
    </ContentPage.Resources>

    <AbsoluteLayout>
        <!-- Skull and Crossbones Overlay -->
        <Image x:Name="SkullImage"
               Source="skull_crossbones.png"
               IsVisible="{Binding ShowSkullWarning}"
               AbsoluteLayout.LayoutFlags="PositionProportional"
               AbsoluteLayout.LayoutBounds="0.5, 0.5, 200, 200"
               Opacity="0.9"
               Aspect="AspectFit" />

        <!-- Main Content -->
        <ScrollView AbsoluteLayout.LayoutFlags="All"
                    AbsoluteLayout.LayoutBounds="0, 0, 1, 1">
            <VerticalStackLayout
                Padding="30,0"
                Spacing="25">
                <!-- Options Button -->
                <Button Text="Options"
                        Style="{StaticResource Button}"
                        Clicked="OnOptionsClicked"
                        HorizontalOptions="End"
                        WidthRequest="100" />

                <Image
                    Source="dotnet_bot.png"
                    HeightRequest="185"
                    Aspect="AspectFit"
                    SemanticProperties.Description="planes drop like a piano below DMMS" />

                <Label
                    Text="{Binding WarningLabelText}"
                    Style="{StaticResource Headline}"
                    SemanticProperties.HeadingLevel="Level1" />
                <Entry Placeholder="Enter DMMS (knots)"
                       Keyboard="Numeric"
                       Text="{Binding DmmsText}"
                       FontAttributes="Bold"
                       HorizontalTextAlignment="Center" />
                <Label
                    Text="(defined minimum maneuvering speed)"
                    Style="{StaticResource SubHeadline}"
                    SemanticProperties.HeadingLevel="Level2"
                    SemanticProperties.Description="DMMS (defined minimum maneuvering speed)" />
                <Label
                    Text=""
                    Style="{StaticResource SubHeadline}"
                    SemanticProperties.HeadingLevel="Level3"
                    SemanticProperties.Description="" />
                <!--<Label
                    Text=""
                    Style="{StaticResource SubHeadline}"
                    SemanticProperties.HeadingLevel="Level4"
                    SemanticProperties.Description="" />-->

                <!-- 3D Button -->
                <Border x:Name="CounterBtnBorder"
                        Stroke="#000000"
                        StrokeThickness="2"
                        StrokeShape="RoundRectangle 20"
                        Background="{StaticResource ActiveGradient}"
                        Padding="10"
                        Margin="10"
                        HorizontalOptions="CenterAndExpand">
                    <Border.Shadow>
                        <Shadow Brush="#333333" Offset="5,5" Radius="10" Opacity="0.5" />
                    </Border.Shadow>
                    <Button x:Name="CounterBtn"
                            Text="DMMS Monitoring Started"
                            FontSize="18"
                            FontAttributes="Bold"
                            TextColor="White"
                            BackgroundColor="Transparent"
                            Clicked="OnCounterClicked"
                            Scale="1"
                            SemanticProperties.Hint="Start DMMS monitoring">
                        <Button.Triggers>
                            <DataTrigger TargetType="Button"
                                         Binding="{Binding IsActive, Source={RelativeSource AncestorType={x:Type ContentPage}}}"
                                         Value="True">
                                <Setter Property="Text" Value="DMMS Monitoring Started" />
                                <Setter Property="TextColor" Value="White" />
                                <Setter Property="SemanticProperties.Hint" Value="Start DMMS monitoring" />
                            </DataTrigger>
                            <DataTrigger TargetType="Button"
                                         Binding="{Binding IsActive, Source={RelativeSource AncestorType={x:Type ContentPage}}}"
                                         Value="False">
                                <Setter Property="Text" Value="=== P A U S E D ===" />
                                <Setter Property="TextColor" Value="White" />
                                <Setter Property="SemanticProperties.Hint" Value="Resume DMMS monitoring" />
                            </DataTrigger>
                            <DataTrigger TargetType="Button"
                                         Binding="{Binding ButtonState, Source={RelativeSource AncestorType={x:Type ContentPage}}}"
                                         Value="Failed">
                                <Setter Property="Text" Value="Pause failed, please click again." />
                                <Setter Property="TextColor" Value="White" />
                                <Setter Property="SemanticProperties.Hint" Value="Retry DMMS monitoring" />
                            </DataTrigger>
                        </Button.Triggers>
                    </Button>
                    <Border.GestureRecognizers>
                        <TapGestureRecognizer Tapped="OnButtonTapped" />
                    </Border.GestureRecognizers>
                </Border>

                <Label
                    Text="{Binding AltitudeText}"
                    Style="{StaticResource SubHeadline}"
                    SemanticProperties.HeadingLevel="Level3" />
                <Label
                    Text="{Binding SpeedText}"
                    Style="{StaticResource SubHeadline}"
                    SemanticProperties.HeadingLevel="Level3" />

                <Label
                    x:Name="ClosestAirportLabel"
                    Text="{Binding ClosestAirportText}"
                    Style="{StaticResource SubHeadline}"
                    SemanticProperties.HeadingLevel="Level3" />
                <Label
                    Text="{Binding LastUpdateText}"
                    Style="{StaticResource SubHeadline}"
                    SemanticProperties.HeadingLevel="Level3" /> 
            </VerticalStackLayout>
        </ScrollView>
    </AbsoluteLayout>
</ContentPage>